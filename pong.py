

#Plays games of Pong using Open AI Gym's Pong environment and a Q-learning Algorithm. 

import math, random
from collections import defaultdict
import gym
from gym import wrappers, logger
import numpy as np
from numba import jit

import collections, random

"""
Our QLearningAlgorithm Class has been adapted from the Blackjack assignment.
actions: list of all possible actions: 0, 2, or 3
discout: 1
featureExtractor: list of (feature, value) pairs extracted from current state
explorationProb: float probability of exploring (randomly or action) rather than following Qopt
"""
class QLearningAlgorithm():
    def __init__(self, actions, discount, featureExtractor, explorationProb):
        self.actions = actions
        self.discount = discount
        self.featureExtractor = featureExtractor
        self.explorationProb = explorationProb
        w = ((("ball", 2, 150, 50), -0.003063032218356928), (("ball", 0, 30, 80), 4.942124070571429e-05), (("ball", 0, 100, 190), 1.6294998802153764e-05), (("agentPaddle", 2, 140), -0.008300037377842445), (("ball", 0, 30, 90), 3.7095715092630146e-05), (("ball", 3, 40, 140), 0.0008308018073640554), (("vx+", 3), -0.15653190116266943), (("ball", 3, 130, 180), 0.0007880730621647546), (("ball", 3, 90, 40), 0.005491861586880862), (("agentPaddle", 0, 170), -0.005819113402411721), (("ball", 0, 30, 70), 0.0003291885714127265), (("ball", 3, 100, 130), 0.0034993932020289157), (("ball", 0, 150, 90), -0.00282684923960883), (("ball", 0, 0, 50), 0.0), (("ball", 2, 90, 40), 0.019474980548015185), (("ball", 3, 20, 180), -0.001802826093992333), (("ball", 3, 50, 130), 0.00023302562116484904), (("ball", 2, 100, 50), 0.0012431911807760361), (("ball", 3, 130, 160), 0.004247884051438469), (("ball", 0, 100, 150), 2.3631889170996202e-05), (("agentPaddle", 3, 90), -0.004680186129852845), (("ball", 3, 0, 60), 0.01858631117834264), (("ball", 2, 90, 60), 0.0007126291754355911), (("ball", 2, 40, 40), 0.009902483581912244), (("ball", 2, 80, 180), 0.0003534744784801304), (("ball", 0, 100, 130), 0.0007579190333188058), (("ball", 0, 160, 80), -0.0009033845944558082), (("ball", 2, 0, 170), 0.005984580539779756), (("ball", 2, 20, 80), -0.0016994167248657274), (("ball", 2, 80, 190), -0.00047294981328521404), (("ball", 2, 40, 60), 0.0004454008518001901), (("ball", 3, 100, 100), 0.002021685577748578), (("ball", 0, 140, 150), 3.380348244733272e-05), (("ball", 2, 0, 190), 0.0040706151579169595), (("ball", 3, 50, 160), 0.0006706513090580479), (("ball", 3, 150, 40), -0.03570287750822729), (("ball", 2, 160, 180), -0.013260104542569847), (("ball", 3, 70, 170), 0.0005688374375053798), (("ball", 2, 80, 150), 0.0003763963767068571), (("ball", 2, 120, 180), 0.0008888496641915405), (("ball", 3, 40, 50), 0.0016932091692360251), (("ball", 3, 150, 90), -0.0028093142142596346), (("ball", 3, 30, 150), 0.0007188369731990207), (("ball", 3, 100, 70), 0.00010367801670613941), (("ball", 0, 120, 90), 0.0003199341896261458), (("ball", 2, 0, 90), 0.0009944737468475947), (("ball", 3, 30, 140), 0.0006913769008709764), (("ball", 3, 50, 190), -0.000510101722431722), (("ball", 0, 160, 40), -0.0495152593781983), (("ball", 0, 80, 150), 8.458791939937797e-05), (("ball", 3, 110, 140), 0.0033460227140920534), (("ball", 0, 140, 60), 0.0013741025162332307), (("ball", 0, 80, 140), 0.0001863246147633154), (("ball", 0, 150, 70), -0.0009623526737388085), (("ball", 0, 140, 50), 0.005496044360576528), (("ball", 2, 120, 150), 0.00136018983443015), (("ball", 2, 130, 110), 0.0007304132093618652), (("ball", 3, 130, 110), 0.001805290614534362), (("ball", 3, 150, 120), -0.007518750276119436), (("ball", 0, 30, 60), 0.0003706085890509959), (("ball", 3, 100, 40), 0.0014338110062627665), (("ball", 0, 120, 120), 0.00021775111526155206), (("agentPaddle", 2, 120), -0.009257114235675412), (("ball", 0, 80, 70), 0.00027731889704304686), (("ball", 0, 40, 150), 0.0005360692577358363), (("ball", 0, 90, 120), 0.00047513618102488326), (("ball", 2, 10, 100), 0.0010161556348807813), (("ball", 2, 30, 70), 0.0007456585608741021), (("agentPaddle", 0, 130), -0.009726391529578488), (("ball", 0, 90, 50), 0.0002748509507682813), (("ball", 0, 30, 40), 0.005975751393038812), (("ball", 2, 140, 170), 0.009398560856194524), (("ballAbove", 3), -0.06137895204988952), (("ball", 3, 130, 70), 0.0009930789547846837), (("ball", 2, 120, 120), 0.0003603953492208202), (("ball", 2, 40, 130), 0.0011744407895770278), (("ball", 3, 130, 50), 0.0007599761672262962), (("ball", 2, 30, 110), 0.0014480487417567805), (("ball", 2, 90, 160), 0.0005226648066554163), (("agentPaddle", 3, 40), -0.023202341910369843), (("ball", 2, 140, 130), 0.006582978486508461), (("ball", 2, 10, 90), 0.0020061336140062627), (("ball", 3, 70, 50), 0.0003829018720022616), (("ball", 2, 30, 100), 0.0011929453799487547), (("ball", 3, 10, 60), 0.00608127586367675), (("ball", 3, 160, 120), -0.005708377962687786), (("ball", 2, 40, 150), 0.0006463494414393255), (("ball", 0, 130, 160), 0.0005067076060507916), (("ball", 0, 70, 120), 0.0003979187161119899), (("ball", 3, 10, 50), 0.0019883349284846503), (("ball", 0, 140, 120), 0.0004496682247803282), (("ball", 0, 130, 170), 0.0003716754573927032), (("ball", 3, 0, 190), 0.006896962941502241), (("ball", 0, 160, 100), -0.020635251548351774), (("ball", 3, 10, 40), 0.0017764954094947102), (("ball", 2, 120, 90), 0.0008298564114478503), (("ball", 3, 20, 130), -0.009725922623956097), (("ball", 0, 130, 180), 0.00030577547579404944), (("vy+", 2), -0.04405792548968305), (("ball", 0, 130, 190), -0.0006618381385553677), (("ball", 2, 10, 50), 0.001962445751938732), (("ball", 0, 70, 110), 0.0006546919156714554), (("ball", 0, 70, 40), 0.0035188489310588366), (("ball", 2, 40, 190), 0.00025552554880943485), (("ball", 3, 20, 150), -0.00011898575359767424), (("ball", 0, 40, 170), 0.00012758230520671255), (("ball", 0, 20, 60), -0.0002856875164947308), (("ball", 3, 150, 160), -0.012217942255976026), (("ball", 2, 70, 90), 0.00047511106884167787), (("ball", 2, 90, 140), 0.0006986036102877216), (("ball", 3, 110, 40), 0.0052653461778508), (("ball", 0, 40, 80), 0.00046746594538264415), (("ball", 0, 70, 90), 0.00013190376834113415), (("agentPaddle", 3, 180), -0.013079801613046775), (("ball", 3, 80, 140), 0.00088980158890611), (("ball", 2, 150, 140), -0.005881361362617102), (("ball", 3, 20, 170), -0.00913257065373848), (("ball", 0, 20, 40), 0.00039896795832784716), (("ball", 3, 70, 100), 0.0021326403810549882), (("agentPaddle", 2, 50), -0.012442166490516274), (("ball", 2, 120, 60), 0.0001603342541346405), (("ball", 0, 90, 100), 0.0004790639332264721), (("ball", 3, 160, 40), -0.06195381605681161), (("ball", 3, 20, 190), -0.0003631253538397342), (("ball", 0, 130, 80), 0.000107167898731427), (("ball", 2, 60, 50), 0.0014727106351535477), (("ball", 3, 0, 50), 0.002797516866546398), (("ball", 2, 130, 40), 0.004666851725128822), (("ball", 0, 130, 90), 0.00014463270790282914), (("ball", 2, 70, 120), 0.0006032233063442621), (("ball", 0, 10, 40), 1.8525309261400725e-05), (("ball", 3, 80, 180), 0.0011388616092971634), (("ball", 3, 150, 50), -0.0010179881109645943), (("ball", 0, 130, 100), 0.000129778293885763), (("ball", 0, 110, 60), 0.00032518294121971423), (("ball", 3, 130, 170), 0.0034261045450285346), (("ball", 0, 130, 110), 0.0002958216892523982), (("ball", 3, 110, 50), 0.00021997897930540512), (("ball", 0, 110, 70), 0.0004753049205012038), (("ball", 3, 20, 60), -0.005287164657184725), (("ball", 0, 10, 60), 0.001050578677423774), (("ball", 3, 80, 160), 0.00021403036084750783), (("ballSame", 3), -0.04419873927862846), (("ball", 3, 30, 190), -0.00023855221498805706), (("vy-", 3), -0.10425172831667842), (("ball", 3, 80, 90), 0.0005911893867087795), (("ball", 0, 30, 180), 3.89694811087804e-05), (("ball", 0, 150, 40), -0.02354104981816199), (("ball", 0, 160, 60), 0.0), (("ball", 2, 20, 180), -0.0016235687573701264), (("ball", 0, 30, 190), -4.9747357922907794e-05), (("ball", 3, 60, 130), 0.0007419394305382096), (("ball", 0, 40, 110), 0.00045625486057629947), (("ball", 3, 140, 120), 0.006257372920672719), (("ball", 0, 50, 50), 0.00028310130166406456), (("ball", 0, 30, 160), 0.00032954795364199254), (("ball", 3, 60, 140), 0.000549061350820186), (("ball", 0, 80, 120), 0.0012855992463998262), (("ball", 0, 50, 60), 0.0004273764384635401), (("ball", 0, 30, 170), 4.876514089067807e-05), (("ball", 0, 120, 130), 0.0001783705638528822), (("ball", 2, 130, 60), 0.0036180017301894523), (("agentPaddle", 2, 190), -0.007521387217172862), (("ball", 3, 150, 130), -0.0008130132433444142), (("ball", 2, 70, 40), 0.01612239033545424), (("ball", 0, 80, 110), 0.0011289139344567672), (("ball", 2, 100, 150), 0.00011820738554311096), (("ball", 0, 100, 70), 5.724488058268842e-05), (("ball", 2, 20, 150), -5.979885693287612e-05), (("agentPaddle", 3, 130), -0.010007149871328476), (("ball", 2, 160, 110), -0.02287996413647277), (("ball", 2, 140, 60), 0.004860465815523989), (("ball", 2, 160, 100), -0.052680770971339955), (("ball", 3, 110, 120), 0.0008667287298548198), (("ball", 0, 120, 160), 0.00044020861899923917), (("agentPaddle", 2, 80), -0.004461567623421376), (("ball", 0, 110, 130), 0.00013791349678606842), (("ball", 0, 100, 60), 0.00014182924353700054), (("ball", 3, 140, 40), 0.0005315319774333936), (("ball", 2, 0, 180), 0.0019906863280182057), (("ball", 0, 120, 180), -8.010333765960861e-05), (("ball", 3, 30, 90), 0.0001303881455341975), (("ball", 3, 140, 50), 0.025283580728690924), (("ball", 3, 60, 70), 0.00016348373035129484), (("ball", 3, 90, 150), 0.0026449696389676553), (("ball", 0, 20, 180), -0.001116049966778763), (("ball", 3, 30, 80), 0.00024128002314327508), (("ball", 3, 140, 60), 0.007066102701509612), (("agentPaddle", 0, 160), -0.006587585685014187), (("ball", 0, 40, 40), 0.0011923577189655423), (("ball", 2, 50, 150), 0.00036831777509380116), (("ball", 3, 80, 70), 0.0006420472335789527), (("agentPaddle", 0, 60), -0.00725308283832106), (("ball", 0, 120, 70), 0.0004320875348094072), (("ball", 2, 50, 140), 0.0005802647029293024), (("ball", 3, 160, 80), -0.0034125563556444923), (("ball", 0, 50, 100), 0.00042411594273068093), (("ball", 0, 150, 170), 1.4678259418206274e-08), (("ball", 2, 30, 150), 0.0010543600941801269), (("ball", 3, 90, 190), -0.0002777875296680501), (("ball", 0, 50, 110), 0.00028631005574766735), (("ball", 3, 160, 170), -0.010470222420618312), (("ball", 0, 60, 190), 0.00012281120715348958), (("ball", 3, 60, 120), 0.00010026540250381499), (("ball", 2, 30, 140), 0.0005882043723445961), (("ball", 3, 90, 180), 0.0009417814210159497), (("ball", 2, 50, 190), -0.0007549642893674391), (("ball", 0, 120, 150), 0.0005414993988790066), (("vx-", 0), 0.014543094829863452), (("ball", 0, 10, 80), 3.2616635119976557e-05), (("ball", 3, 80, 60), 0.001162344810105142), (("ball", 0, 60, 180), 7.231266180598723e-05), (("ball", 2, 30, 130), 0.000282832984659684), (("ball", 2, 50, 180), 0.0002681659086455473), (("ball", 0, 110, 180), 0.00024369099734354214), (("ball", 0, 10, 170), 4.107103221800333e-05), (("ball", 0, 60, 170), 0.0002963904105508561), (("ball", 0, 110, 190), -0.0005652818280052206), (("ball", 2, 100, 80), 0.0008196612022014351), (("ball", 3, 80, 40), 0.003086725617353578), (("ball", 0, 60, 160), 0.00014706145391529), (("ball", 2, 30, 190), 2.6090094647678074e-06), (("ball", 3, 90, 70), 0.0012758410085075035), (("ball", 2, 70, 130), 0.0005996687025460104), (("ball", 0, 10, 190), 0.0009400317332151473), (("ball", 2, 80, 40), 0.005186327245984051), (("ball", 2, 40, 50), 0.0012334684155040879), (("ball", 2, 30, 180), 0.00023682707549733573), (("ball", 0, 150, 60), -0.0009641015525413508), (("ball", 2, 20, 60), -0.003996654458614534), (("ball", 3, 160, 180), -0.01508114081215427), (("ball", 2, 30, 170), 0.00010609168102532816), (("vy+", 0), -0.04471164298423919), (("ball", 0, 70, 180), 0.0002551655444417007), (("ball", 2, 100, 70), 7.745534481498663e-05), (("ball", 3, 120, 80), 0.0018039719822126633), (("ball", 0, 50, 40), 0.0010021590331574161), (("ball", 2, 30, 160), 0.0010799539667378606), (("ball", 0, 80, 100), 0.00015245248550781065), (("ball", 3, 50, 60), 0.0024561478096175996), (("ball", 2, 100, 120), 0.00024844183785110535), (("ball", 3, 120, 40), 0.0031118155693062952), (("ball", 0, 100, 80), 0.0003821217211721416), (("ball", 3, 90, 110), 0.0015445281793336429), (("ball", 0, 70, 160), 4.772627408980861e-05), (("ball", 0, 50, 190), -0.000513913141601164), (("ball", 3, 120, 50), 0.00016925756919345327), (("ball", 2, 60, 70), 0.00019756923958216135), (("ball", 3, 20, 80), -0.001964245501509356), (("ball", 2, 110, 140), 0.0008054041637630341), (("ball", 3, 90, 100), 0.0026641788965882005), (("ball", 0, 90, 140), 0.0003835686799275965), (("ball", 2, 70, 160), 8.166719660724863e-05), (("ball", 0, 150, 150), -0.00490327822136155), (("ball", 3, 60, 50), 0.0013504143190088203), (("agentPaddle", 3, 80), -0.001659657974756663), (("ball", 2, 60, 120), 0.0002640976738348194), (("ball", 2, 100, 110), 0.00016429487839450855), (("ball", 3, 60, 60), 0.0007123768140609899), (("ball", 0, 70, 150), 0.00021683467676326295), (("ball", 3, 50, 170), 0.0002130475042979709), (("ball", 3, 150, 80), -0.0009508626715589492), (("ball", 0, 140, 140), 0.0015654918710078436), (("ball", 3, 50, 90), 0.0008914518468631277), (("ball", 2, 160, 40), -0.07696607030217574), (("ball", 3, 20, 120), -0.0031328675402003555), (("ball", 0, 140, 130), 0.0023477014075911694), (("ball", 0, 70, 130), 0.00017151564098861674), (("ball", 0, 100, 180), 0.0002729658912974346), (("ball", 3, 110, 170), 0.0008940430377146624), (("ball", 2, 110, 170), 0.0005396014475972783), (("ball", 2, 80, 100), 0.0005346999570868298), (("ball", 2, 70, 190), -0.0005662641284249753), (("ball", 2, 160, 60), -0.0008625863590217792), (("ball", 2, 110, 160), 0.00046375666620097666), (("ball", 2, 160, 70), -0.00773296090722632), (("ball", 2, 20, 120), -0.002471321756537578), (("ball", 0, 110, 120), 0.00016319019475825666), (("ball", 3, 100, 140), 0.003052329011146064), (("agentPaddle", 2, 150), -0.006799999862065966), (("ball", 2, 90, 120), 0.000866586580721377), (("ball", 2, 40, 70), 0.0009844015020286456), (("ball", 3, 50, 120), 0.0007448887981383336), (("ball", 3, 120, 100), 0.0010026452156022), (("ball", 0, 100, 140), 0.0005030434368325485), (("ball", 0, 110, 40), 0.002008614998602268), (("ball", 2, 110, 120), 0.00029192403299237396), (("ball", 3, 120, 110), 0.0006756758171851255), (("ball", 3, 70, 190), -0.0008991604246737717), (("ball", 2, 130, 90), 0.0004975971538045033), (("ball", 2, 160, 190), -0.032934961598215844), (("ball", 2, 20, 90), -0.0052287316855287175), (("ball", 0, 100, 120), 9.375991077368392e-05), (("ball", 0, 60, 70), 4.317584689557918e-05), (("ball", 3, 70, 130), 0.0006838073180411635), (("ball", 3, 90, 60), 0.0010886286002835582), (("ball", 0, 80, 90), 0.0001783555540152471), (("ball", 3, 100, 110), 0.00019784597968121453), (("ball", 0, 140, 40), 0.00012703034975882787), (("ball", 0, 60, 60), 0.00017185425237443386), (("ball", 2, 110, 90), 0.0029392201209024692), (("ball", 3, 90, 50), 0.0007581759697361173), (("ball", 3, 30, 180), 0.0001676300409050778), (("ball", 3, 50, 150), 0.00069619779423887), (("ball", 3, 120, 70), 0.0018103844876754319), (("ball", 0, 60, 50), 0.0005346061375268485), (("ball", 3, 70, 150), 0.0004081953085451113), (("ball", 2, 110, 80), 0.0038402339137131396), (("ball", 0, 80, 190), -0.000400298103466927), (("ball", 0, 60, 40), 0.0006982358632575621), (("ball", 2, 100, 90), 0.005495175801863023), (("ball", 0, 80, 180), 0.00027149167053059357), (("ball", 2, 80, 160), 0.0002177673890753244), (("ball", 2, 30, 60), 0.00040628912296146485), (("ball", 3, 10, 70), 0.0010612060373689609), (("ball", 2, 120, 190), -0.0005638915619381389), (("agentPaddle", 2, 60), -0.00926983064003376), (("ball", 2, 80, 170), 0.0002978624581042395), (("ball", 3, 150, 70), -0.007526284607058472), (("ball", 2, 30, 50), 0.0008428848406867794), (("ballBelow", 3), -0.04012494694113196), (("ball", 3, 100, 80), 0.0015767703729456894), (("ball", 0, 120, 80), 0.0005461220143998033), (("ball", 3, 130, 140), 0.0015639673947700089), (("agentPaddle", 3, 120), -0.010422834501969394), (("ball", 2, 30, 40), 0.031878773573468175), (("ball", 3, 50, 180), 0.000378875987619615), (("ball", 3, 120, 160), 0.003073836794344643), (("agentPaddle", 0, 90), -0.007253990018418935), (("ball", 0, 120, 100), 0.00022044837626224243), (("ball", 3, 120, 170), 0.0019617418109246125), (("ball", 2, 120, 170), 0.0019144229464537086), (("ball", 0, 130, 40), 0.0004750844430914961), (("ball", 3, 40, 60), 0.0010119258294984663), (("ball", 2, 80, 130), 0.0007368284880067311), (("ball", 2, 30, 90), 0.00038034357432387063), (("agentPaddle", 2, 160), -0.012445428537013824), (("ball", 2, 150, 110), -0.0251712690843881), (("ball", 3, 130, 100), 0.0014155041898144918), (("ball", 2, 80, 140), 0.0004893842304482338), (("ball", 2, 100, 140), 0.0006732787817707988), (("ball", 2, 30, 80), 0.0004242520496137631), (("ball", 3, 30, 130), 0.0003533298563652524), (("ball", 3, 100, 50), 0.0016763779224438127), (("ball", 3, 40, 40), 0.003583497080653542), (("ball", 0, 150, 100), -0.0019786982726911675), (("ball", 3, 10, 110), 0.0030549710362909634), (("ball", 3, 10, 170), 9.118475266997577e-05), (("ball", 2, 40, 100), 0.0010917717951700642), (("ball", 3, 120, 130), 0.0009866100437944682), (("ball", 2, 50, 90), 0.0013308202155025344), (("vx-", 2), 0.003402806411815277), (("ball", 3, 10, 100), 0.0019815310580028576), (("ball", 0, 90, 60), 0.0003648509278284715), (("ball", 0, 80, 130), 0.0004475353438251094), (("ball", 2, 50, 80), 0.0013956582848390316), (("ball", 3, 160, 90), -0.00743946375545004), (("ball", 2, 40, 120), 0.0005496793087552107), (("ball", 0, 130, 130), 0.0003224651757559756), (("ball", 3, 110, 150), 0.002810000394552331), (("ball", 2, 30, 120), 0.0010897864052815587), (("vx+", 2), -0.15150185405755587), (("ball", 2, 120, 130), 0.0005250173504403824), (("ball", 0, 130, 140), 0.00036070467338053487), (("ball", 0, 0, 170), 0.0), (("ball", 2, 40, 140), 0.0012077058192299316), (("ball", 0, 130, 150), 0.00040125089345137747), (("ball", 0, 20, 110), 4.680682883518157e-06), (("ball", 2, 60, 110), 0.00020223203358763338), (("ball", 0, 40, 130), 0.00022918702582257753), (("ball", 2, 50, 120), 0.001272480396293607), (("ball", 3, 70, 40), 0.005451322651039397), (("ball", 0, 0, 190), 0.0030199596723544837), (("ball", 0, 120, 110), 0.00011485126837552595), (("ball", 2, 150, 190), -0.022061108023551827), (("ball", 2, 140, 190), 6.633108361397291e-05), (("ball", 0, 20, 90), -0.0012494719008053015), (("ball", 2, 40, 80), 0.0010607548142804193), (("ball", 0, 0, 180), 0.0009935608505834848), (("ball", 0, 140, 110), -1.4108266519310647e-05), (("ball", 3, 160, 100), -0.03197201283036888), (("ball", 3, 40, 120), 0.0005012691177351324), (("ball", 3, 70, 60), 0.0007601396969833614), (("ball", 3, 140, 160), 0.002642788188279159), (("ball", 0, 140, 100), 0.00015537718217637877), (("agentPaddle", 2, 90), -0.003761701509071135), (("ball", 2, 120, 100), 0.0006110193939993471), (("ball", 3, 20, 140), -0.0029238161913351665), (("ball", 0, 20, 70), 7.537604246003288e-05), (("ball", 2, 40, 110), 0.001210418945947295), (("ball", 3, 140, 170), 0.01501376770968862), (("ball", 0, 120, 190), -0.0004915425439565021), (("ball", 3, 160, 130), -0.00043196461525455446), (("ball", 2, 140, 140), 0.009251599888614294), (("ball", 3, 40, 100), 0.0006096881674013141), (("ball", 3, 140, 180), 0.006334442870224459), (("ball", 0, 90, 70), 0.0003643743386729701), (("ball", 2, 150, 150), -0.008892751736627503), (("ball", 0, 40, 160), 0.00018899800011963632), (("ball", 3, 40, 110), 0.0010957229591244135), (("ball", 0, 20, 50), -0.008608590369742198), (("ball", 3, 150, 190), -0.05457447738720835), (("ball", 2, 70, 80), 0.0012754531305626787), (("ball", 3, 140, 190), -0.00015028841873667405), (("ball", 3, 40, 80), 0.000479430673377768), (("ball", 2, 10, 60), 0.015983870503846895), (("ball", 2, 160, 150), -0.01077556137730201), (("ball", 3, 80, 150), 0.00026710458860333886), (("ball", 2, 150, 130), -0.0017478746814494274), (("ball", 2, 10, 190), 0.0027961725090729908), (("ball", 0, 130, 70), 0.0002740931885669711), (("ball", 3, 40, 90), 0.0009023863741498421), (("ball", 3, 110, 90), 0.0015103929195010451), (("ball", 2, 120, 70), 0.003043116278305621), (("ball", 2, 140, 100), 0.0009077517355760783), (("ball", 3, 110, 80), 0.0022715679190032914), (("ball", 0, 90, 110), 0.0004639582723565191), (("ball", 3, 80, 130), 0.0027798345891548153), (("ball", 2, 140, 110), 0.0006326393675638213), (("ball", 3, 40, 70), 0.00021043554862335874), (("ball", 0, 30, 150), 0.00011075440330835647), (("ball", 0, 40, 70), 0.0005824546433549374), (("ball", 2, 50, 60), 0.0010602668368216864), (("ball", 2, 70, 110), 0.001144156032901466), (("ball", 3, 140, 80), 0.0005915660491441231), (("ball", 3, 80, 190), -0.00031555911298187817), (("ball", 2, 130, 100), 0.00032931141617405864), (("ball", 3, 140, 90), 0.0023354550879645768), (("ball", 0, 30, 130), 0.00020259794579068026), (("ball", 3, 140, 100), 0.0016155673566074472), (("ball", 3, 80, 170), 0.0007736882859840088), (("ball", 2, 120, 40), 0.00458953288434202), (("ball", 0, 20, 160), -0.00031430151300062203), (("ball", 2, 140, 70), -4.3543129964073764e-05), (("ball", 2, 150, 90), -0.004706842788377595), (("ball", 3, 140, 110), 0.00040719835583939105), (("ball", 2, 60, 60), 0.0005188439927313474), (("ball", 3, 160, 60), 0.0), (("agentPaddle", 3, 70), -0.004575661953663271), (("ball", 0, 70, 60), 0.00029099191657050666), (("ball", 2, 20, 190), -7.407898765963884e-05), (("ball", 0, 60, 120), 8.01795334621453e-05), (("ball", 0, 40, 100), 0.00011692900205616575), (("ball", 3, 130, 80), 0.0005221486256358291), (("ball", 2, 60, 40), 0.0075247248064211625), (("ball", 2, 90, 90), 0.0006881119737899243), (("ball", 2, 0, 110), 0.019663277819575418), (("ball", 3, 110, 130), 0.000215463024846622), (("ball", 0, 110, 80), 0.0007383128319098712), (("ballAbove", 0), -0.06125830960717126), (("ball", 2, 100, 180), 0.0006718757843479935), (("ball", 0, 110, 90), 0.00047658894820688834), (("ball", 2, 20, 140), -0.0030378415605073882), (("ball", 3, 150, 100), -0.005729625398581592), (("ball", 0, 160, 50), -0.0007658715605940352), (("ball", 3, 60, 180), 0.00039391871996530855), (("ball", 0, 120, 140), 0.00028371865622025204), (("ball", 3, 70, 90), 0.00040766354593312445), (("ball", 3, 60, 190), 0.00010943558350605823), (("ball", 2, 110, 40), 0.009916988910612256), (("ball", 3, 30, 120), 0.0010446385392884647), (("agentPaddle", 0, 120), -0.011539155882804717), (("ball", 2, 160, 160), -0.019870073058969203), (("ball", 2, 120, 140), 0.0003777324309125817), (("ball", 2, 130, 50), 0.0007876327502668708), (("ball", 2, 10, 120), 0.0013699783089190503), (("ball", 2, 160, 170), -0.00770002250432222), (("ball", 0, 10, 90), 1.7089332356264535e-06), (("ball", 0, 100, 50), 0.0005854063618639523), (("agentPaddle", 0, 190), -0.009117353316045882), (("ball", 2, 130, 120), 0.0006125160049889722), (("ball", 2, 70, 60), 0.000683264484485238), (("ball", 2, 130, 70), 0.0017601437823900389), (("ball", 2, 80, 110), 0.0031833698543286193), (("vy+", 3), -0.041859006449874496), (("ball", 0, 40, 50), 0.0005963020995846212), (("ball", 2, 140, 160), 0.001519924182534705), (("ball", 0, 50, 70), 0.0005037435797201808), (("ball", 3, 60, 80), 0.0020351410447693808), (("ball", 0, 80, 80), 0.00019662240350429004), (("ball", 3, 130, 90), 0.00033968386808523094), (("ball", 2, 150, 70), -0.005711647321529242), (("ball", 2, 60, 100), 0.0022121789084898276), (("ball", 3, 80, 100), 0.0005864195022830912), (("ball", 2, 160, 130), -0.0023306822160208606), (("ball", 3, 60, 90), 0.0028355257307882895), (("ball", 2, 10, 180), 0.007833059569985429), (("ball", 0, 110, 140), 0.000640681286205478), (("ball", 0, 100, 100), 0.0005148307605502705), (("ball", 2, 130, 80), 0.00035217008206466703), (("ball", 2, 160, 140), -0.012454906750464454), (("ball", 2, 10, 170), 1.964175854363426e-05), (("agentPaddle", 2, 100), -0.00496131132956542), (("ball", 0, 110, 150), 0.0004935826461441697), (("ball", 2, 60, 80), 0.001361143823185068), (("ball", 2, 80, 70), 0.0006901124253997373), (("ball", 3, 150, 110), -0.02180833020398843), (("agentPaddle", 3, 160), -0.0065926821704381956), (("ball", 2, 60, 90), 0.0029800984704813375), (("vx+", 0), -0.16358895834664997), (("ball", 3, 30, 70), 0.00012258791224665269), (("ball", 0, 50, 120), 0.0002384039066954219), (("ball", 0, 0, 70), 0.0), (("ball", 2, 100, 60), 0.0004227814062365412), (("ball", 3, 30, 60), -0.000547262371435537), (("agentPaddle", 3, 110), -0.01013506645805947), (("ball", 3, 160, 150), -0.009567091355734567), (("ball", 2, 50, 130), 0.0004158957427362501), (("ball", 2, 100, 160), 0.0005913794987198193), (("ball", 0, 10, 70), 7.40200873877976e-05), (("ball", 0, 0, 90), 0.0), (("ball", 0, 150, 160), -0.003948632948940079), (("ball", 0, 50, 150), 0.0003259326724260119), (("ball", 3, 80, 50), 0.0016070684146582501), (("ball", 0, 100, 110), 5.1471009049068876e-05), (("ball", 3, 60, 100), 0.0018510695049416491), (("vy-", 0), -0.10418517466903014), (("ball", 0, 150, 190), -0.016537877695956354), (("ball", 3, 20, 50), -0.014591992057544466), (("ball", 0, 0, 110), 0.0), (("ball", 2, 60, 190), 8.188740842656726e-06), (("ball", 3, 160, 190), -0.06210461881824291), (("ball", 0, 0, 100), 0.0009997707617665932), (("ball", 2, 50, 170), 0.00045867717240581575), (("ball", 2, 130, 140), 0.0010482679422110146), (("ball", 0, 70, 190), -0.00047708457955868854), (("ball", 2, 60, 160), 0.00027393800684144396), (("ball", 2, 10, 110), 0.014187676974409948), (("ball", 3, 20, 70), -0.00016813408658603908), (("ball", 2, 50, 160), 0.0003911544800766195), (("ball", 3, 150, 150), -0.01121136510435929), (("ball", 3, 50, 50), 0.0007301247436545392), (("ball", 2, 60, 170), 0.0006991281034202695), (("ball", 0, 150, 140), -0.002910594055037842), (("ball", 0, 140, 170), 0.0027836495829087634), (("ball", 0, 70, 170), 0.0001688091429535041), (("agentPaddle", 0, 80), -0.004944413500979151), (("ball", 3, 40, 180), 0.0007146329189424236), (("ball", 3, 20, 90), -0.005827629616311454), (("ball", 0, 140, 160), 0.00042267248698168417), (("ball", 2, 70, 150), 0.00015125111608389072), (("ball", 2, 60, 150), 2.5602972868437787e-05), (("ball", 3, 40, 190), 0.0005064902494557904), (("agentPaddle", 2, 170), -0.007537961495746069), (("ball", 3, 40, 160), 0.0005388928311760305), (("ball", 3, 20, 110), -0.0002765761518634733), (("ball", 3, 100, 180), 0.0018806615170015235), (("ball", 2, 60, 130), 0.0010726401492140946), (("ball", 3, 40, 170), 0.0003839815710236789), (("ball", 2, 60, 180), 0.00020428166219310247), (("ball", 3, 50, 80), 0.0009331853194085438), (("ball", 0, 50, 160), 0.00023300664295057682), (("ball", 3, 120, 60), 0.00015938056560393997), (("ball", 0, 150, 110), -0.014495278967969424), (("ball", 0, 90, 190), -0.00020138241261511268), (("ball", 0, 160, 130), -0.0006963333340923976), (("ball", 0, 50, 170), 0.0001055247438323668), (("ball", 3, 40, 150), 0.0011447121597939764), (("ball", 0, 100, 170), 0.000480351557084169), (("ball", 2, 70, 180), 0.00037492394886346554), (("ball", 2, 110, 150), 0.000772710108280592), (("ball", 0, 160, 150), -0.001828213863736414), (("ball", 2, 140, 180), 0.006639485961213146), (("ball", 3, 40, 130), 0.0006914976536467887), (("ball", 0, 60, 110), 2.490891187049334e-05), (("ball", 3, 60, 40), 0.003998147049135138), (("ball", 0, 0, 40), 0.0009945148748543647), (("ball", 3, 100, 150), 0.00014494822773058262), (("ball", 2, 20, 100), -0.0013247338972201248), (("ball", 2, 10, 80), 0.0001302887152590475), (("ball", 0, 60, 100), 0.0005947381399065253), (("ball", 3, 70, 160), 0.00011909573480720382), (("ball", 3, 50, 110), 0.0009644337769075928), (("ball", 0, 60, 90), 0.0012020538359090096), (("ball", 0, 0, 60), 0.004064991389188584), (("ball", 0, 90, 160), 0.00025713480399829227), (("ball", 2, 150, 60), -0.004904003907051713), (("ball", 3, 0, 40), 0.002921303269595747), (("ball", 0, 60, 80), 0.0004062693223112162), (("ball", 3, 70, 180), 0.001215899731915961), (("ball", 2, 110, 190), -0.0015920776267125954), (("ballAbove", 2), -0.0483728440624038), (("ball", 2, 110, 180), 0.0013203002382242892), (("ball", 2, 150, 100), -0.009173428752305344), (("ball", 2, 150, 40), -0.049710946217686895), (("agentPaddle", 3, 60), -0.004674160993779407), (("ball", 3, 130, 190), -0.0006342289207470782), (("ball", 3, 100, 120), 0.00037989629722710595), (("ball", 2, 20, 70), -0.000211761412833148), (("ball", 0, 150, 80), 1.5944893351185956e-05), (("ball", 2, 10, 130), 3.606807185443805e-05), (("ball", 2, 90, 50), 0.0010291225591765882), (("ball", 2, 150, 160), -0.010370242837508795), (("ball", 3, 50, 140), 0.0011334874468937415), (("ball", 2, 100, 40), 0.0012609878625383464), (("ball", 3, 120, 120), 0.0008901633431591926), (("ball", 3, 70, 140), 0.0004264939637974115), (("ball", 2, 110, 70), 0.0006671834473806435), (("ball", 0, 90, 90), 0.0002155684855213914), (("ball", 0, 30, 120), 0.0003244861219331243), (("ball", 0, 150, 180), -0.002089434733960661), (("ball", 3, 130, 150), 0.0024962562778436457), (("ball", 3, 10, 90), 0.0009991870714524003), (("ball", 2, 150, 80), -0.0028505296438726332), (("agentPaddle", 0, 40), -0.027033436117522083), (("ball", 0, 30, 100), 0.0002964988525161351), (("ball", 0, 40, 180), 1.156276623561944e-05), (("ball", 3, 10, 80), 8.244802837649357e-06), (("ball", 3, 30, 170), 0.0005930679106120401), (("ball", 0, 30, 110), 0.00031355553559669414), (("ball", 3, 100, 90), 0.003562618475711127), (("ball", 3, 130, 130), 0.0009078182285798687), (("ball", 0, 150, 50), -0.00020856658894914803), (("ball", 2, 110, 110), 0.0006026473463246005), (("ball", 2, 150, 170), -3.119047221668416e-05), (("ball", 3, 30, 160), 0.0014840801824993542), (("agentPaddle", 0, 110), -0.011267660918030548), (("ball", 3, 120, 90), 0.0017142022681800781), (("ball", 2, 160, 120), -0.007534871165199872), (("ball", 0, 20, 140), -0.0013325834801774126), (("ball", 2, 110, 100), 0.0007162512112006465), (("ball", 2, 150, 120), -0.004871069730178568), (("ball", 0, 80, 170), 0.00015259278167538683), (("ball", 3, 110, 160), 0.0009321190375798835), (("ball", 0, 10, 120), 6.99096163026974e-05), (("ball", 3, 150, 140), -0.005746634390698548), (("ball", 0, 80, 160), 9.055513627975879e-05), (("ball", 3, 110, 190), 0.0014892086109995891), (("ball", 3, 10, 120), 9.964924720972697e-05), (("ball", 2, 20, 50), -0.014127715783208527), (("ball", 2, 40, 90), 0.0012854401055001634), (("ball", 2, 10, 70), 0.0037779921934808234), (("ball", 3, 110, 180), 0.00435987601624563), (("ball", 0, 160, 160), -0.013352591857898005), (("ball", 3, 100, 60), 0.0007745309351647445), (("ball", 2, 160, 80), -0.0007966370857880029), (("ball", 2, 90, 100), 0.004087289313136199), (("ball", 2, 130, 150), 0.0021351194121267993), (("ball", 0, 30, 50), 0.0002675916176279609), (("ball", 3, 120, 180), 0.0017310772781905911), (("ball", 2, 160, 90), -0.009422568659499845), (("ball", 0, 90, 80), 0.0003501582843653885), (("ball", 3, 120, 190), -0.0009199167939250209), (("ball", 0, 160, 110), -0.007155110936231707), (("ball", 0, 20, 120), -0.001156277672638774), (("ball", 3, 0, 110), 0.006926057248771852), (("ball", 2, 90, 180), 0.0003380513685891806), (("ball", 3, 160, 70), -0.007001713617816569), (("ballSame", 2), -0.052748321941251744), (("vy-", 2), -0.10389302310841128), (("ball", 3, 140, 130), 0.011606219944735105), (("ball", 2, 120, 160), 0.001315070066932668), (("ball", 0, 120, 60), 5.59060183517281e-05), (("ball", 3, 120, 140), 0.000945688935186929), (("ball", 0, 20, 100), -0.0003061258782336422), (("ball", 3, 140, 140), 0.01182314772662092), (("ball", 0, 120, 40), 0.0012871632614325826), (("ball", 3, 120, 150), 0.0035403498875867558), (("ball", 2, 50, 70), 0.001217267148766447), (("ball", 3, 110, 110), 0.0017741279306627718), (("ball", 3, 140, 150), 0.0007193233816261416), (("ball", 0, 90, 40), 0.0033977389517167974), (("ball", 2, 150, 180), -0.00538489876355044), (("agentPaddle", 2, 130), -0.010080475521412134), (("ball", 0, 20, 80), -0.000187514176714797), (("ball", 3, 110, 100), 0.0012411396457516835), (("ball", 3, 160, 110), -0.013905836058830084), (("ball", 0, 40, 140), 0.00028173329434228513), (("ball", 3, 0, 170), 0.002986088664448714), (("ball", 0, 90, 150), 0.0003692495772141019), (("ball", 2, 110, 60), 0.0004301169162106), (("ball", 0, 50, 180), 6.215391241813098e-05), (("ball", 2, 120, 110), 0.0003364681365951018), (("agentPaddle", 3, 150), -0.008586997518460059), (("agentPaddle", 0, 180), -0.005977922856814857), (("ball", 2, 110, 50), 0.0005078479720921989), (("agentPaddle", 3, 170), -0.010312907409687398), (("ball", 3, 130, 60), 0.0021419917312128977), (("ball", 2, 50, 110), 0.0016783281988026798), (("ball", 2, 0, 40), 0.0019325927299085784), (("ball", 2, 90, 170), 0.0004157627670930621), (("ball", 2, 40, 170), 0.00020093135791446898), (("ball", 0, 40, 190), -1.4286009035219037e-05), (("ball", 2, 50, 100), 0.001209717847944656), (("ball", 3, 150, 180), -0.004131566920076212), (("ball", 2, 70, 70), 0.0012372463681353891), (("ball", 3, 130, 40), 0.0005370702176515467), (("ball", 2, 90, 190), -0.00029728964949563767), (("agentPaddle", 0, 70), -0.006534497623612438), (("ball", 0, 160, 70), -0.0017782199507033647), (("ball", 0, 120, 50), 0.00023601849246162294), (("ball", 3, 0, 180), 0.0060801819761505255), (("agentPaddle", 2, 110), -0.01052326237898665), (("ball", 2, 40, 160), 0.0003275544502543616), (("ball", 2, 140, 150), 0.0006931446193002655), (("ball", 3, 140, 70), 0.00044388475248189317), (("ballBelow", 0), -0.03803624415086432), (("ball", 2, 0, 50), 0.006895379521373274), (("ball", 0, 70, 100), 0.0007286536965563825), (("ball", 3, 110, 70), 0.0015974358324534527), (("ball", 2, 0, 60), 0.02922197663165471), (("agentPaddle", 2, 40), -0.02897677673426697), (("ball", 3, 150, 170), -0.004508987022682163), (("ball", 2, 70, 100), 0.001137207606504083), (("ball", 2, 90, 150), 0.000743587675106162), (("ball", 2, 0, 70), 0.003991415497163045), (("ball", 0, 40, 90), 0.0001714649692065514), (("ball", 2, 10, 40), 0.0029825689539351523), (("agentPaddle", 0, 150), -0.007008747817197146), (("ball", 0, 70, 80), 0.0003970668294785298), (("ball", 0, 140, 80), 1.521904648611054e-05), (("ball", 3, 20, 160), -0.0010298331175024695), (("ball", 0, 80, 40), 0.0002855478993626513), (("ball", 3, 70, 110), 0.0027851788986384234), (("ball", 0, 110, 50), 0.00025538701224807895), (("ball", 0, 10, 130), 3.625701893509627e-05), (("ball", 2, 120, 50), 0.0005376452365666919), (("ball", 2, 140, 120), 0.002527837380418635), (("ball", 3, 110, 60), 0.0017373117944548926), (("ball", 0, 160, 90), -0.0015311422732436266), (("ball", 0, 160, 140), -0.005528321733427707), (("ball", 0, 60, 130), 0.0006606524789246735), (("ball", 2, 50, 50), 0.0009150745055779847), (("ball", 0, 160, 120), -0.002718616980308124), (("ball", 0, 70, 70), 0.0003689910907224434), (("ball", 2, 20, 160), -0.0010369742790217094), (("ball", 2, 120, 80), 0.0020706010513125623), (("ball", 3, 60, 150), 2.4749870960066183e-05), (("ball", 2, 50, 40), 0.008568270135826535), (("ball", 3, 70, 120), 0.0015469123791280524), (("ball", 3, 160, 50), 0.0), (("ball", 0, 30, 140), 0.0002671869058632016), (("ball", 0, 40, 120), 0.00017400884612528455), (("ball", 3, 70, 70), 0.0010818398060441817), (("ball", 0, 70, 50), 0.00035101460581287125), (("ball", 2, 140, 80), 0.0005052955556882595), (("ball", 2, 110, 130), 0.0003943415829236006), (("ball", 0, 10, 50), 0.0), (("ball", 2, 140, 90), 0.0019275750117839258), (("ball", 3, 80, 80), 0.0004195913517267847), (("ball", 0, 130, 120), 0.00020970111147452117), (("ball", 3, 130, 120), 0.0010627151867506743), (("ball", 3, 70, 80), 0.0010576751192767975), (("ball", 2, 90, 130), 0.0012512465606406356), (("ball", 2, 20, 130), -0.008794214551611813), (("ball", 0, 80, 60), 0.00044696921094595197), (("agentPaddle", 3, 190), -0.014462222685715401), (("agentPaddle", 0, 140), -0.009414899907851843), (("ball", 0, 10, 180), 3.1177358662107436e-05), (("ball", 2, 140, 40), 0.0007886882655199451), (("ball", 0, 110, 100), 0.00035083252691628646), (("agentPaddle", 0, 50), -0.01256014063351369), (("ball", 2, 140, 50), 0.013224186413495884), (("agentPaddle", 3, 100), -0.007086488231868129), (("ball", 0, 140, 180), 0.0004036780153892321), (("ball", 0, 110, 110), 0.0003990926161479232), (("ball", 3, 20, 100), -0.001559742871620113), (("ball", 3, 80, 120), 0.004169389330609586), (("ball", 0, 100, 40), 0.000465181088505273), (("ball", 2, 70, 50), 0.0008301841477416382), (("ball", 3, 10, 130), -2.013072098012613e-05), (("ball", 0, 10, 110), 0.001041181668942614), (("ball", 2, 80, 120), 0.0035436710444151287), (("ball", 3, 60, 160), 0.0008146172479156131), (("ball", 3, 90, 140), 0.0022572796170292134), (("ball", 3, 30, 110), 0.0009134095237420325), (("ball", 0, 50, 80), 0.0005719764596093778), (("ball", 3, 60, 170), 0.0010742469496449276), (("ball", 3, 90, 130), 0.001875845627343272), (("ball", 3, 30, 100), 0.0005069903052859369), (("ball", 3, 10, 190), 0.00648821288116636), (("ball", 0, 50, 90), 0.0003447225214934331), (("ball", 3, 80, 110), -0.00041690388052070343), (("ball", 0, 40, 60), 0.0002026356095703507), (("ball", 3, 100, 170), 0.0034072963718803175), (("ball", 3, 10, 180), 0.005059758402802457), (("ball", 2, 40, 180), 0.0004333220455705696), (("ball", 0, 120, 170), 0.00014382485141651183), (("ball", 0, 140, 70), 9.697188202775105e-06), (("ball", 2, 100, 130), 0.0017211752239958166), (("ball", 2, 80, 80), 0.0003751110158472184), (("ball", 0, 130, 50), 0.0003759782550121355), (("ball", 3, 160, 140), -0.010884641993410486), (("ball", 2, 80, 90), 0.0005323797554973361), (("ball", 0, 130, 60), 0.0006241552338530325), (("ball", 3, 90, 170), 0.0005299279784921101), (("ballSame", 0), -0.04915707293287541), (("ball", 2, 100, 190), 0.0001549852994062633), (("ball", 3, 90, 160), 0.0011456029764058014), (("ball", 0, 20, 190), -0.00020114468556208507), (("ball", 2, 100, 100), 0.0037902860148131784), (("ball", 0, 110, 160), 0.0001508253351133174), (("ball", 0, 140, 90), 0.0003408946565293204), (("ball", 2, 100, 170), 0.0012672308688785573), (("ball", 3, 20, 40), -0.0030055758601586196), (("ball", 0, 20, 170), -0.007375361484803989), (("ball", 0, 110, 170), 0.000225393981460237), (("ball", 3, 150, 60), -0.0027428946868364515), (("ball", 2, 80, 50), 0.0015878206089113707), (("ball", 2, 80, 60), 0.0008495954841250706), (("ball", 0, 80, 50), 0.00047422870146346765), (("ball", 0, 20, 150), 5.990341565562155e-06), (("ball", 3, 30, 50), 0.00010015076011580626), (("ball", 2, 20, 40), 0.005174842972459802), (("ball", 3, 160, 160), -0.037378555385473286), (("ball", 3, 60, 110), 0.00020468605213356178), (("ball", 3, 30, 40), 0.011426292745152894), (("agentPaddle", 3, 50), -0.006628715106915651), (("agentPaddle", 2, 70), -0.005324086766373266), (("ball", 3, 100, 160), 0.002154296525348639), (("ball", 0, 20, 130), -0.00519906161893905), (("ball", 0, 90, 180), 0.00017206662222653295), (("ball", 3, 50, 40), 0.002901966031102097), (("ball", 2, 130, 130), 0.00032393874324790063), (("agentPaddle", 0, 100), -0.007159766136016163), (("ball", 3, 90, 90), 0.0007194230972046735), (("ball", 0, 160, 170), -0.003195372524488809), (("ball", 0, 50, 130), 0.00022122761536883526), (("ball", 3, 90, 80), 0.000911982733895735), (("ball", 2, 70, 140), 0.0007007892014437267), (("ball", 2, 0, 100), 0.003987407252301534), (("ball", 0, 50, 140), 0.00039164296894661336), (("ball", 0, 150, 130), 7.43267119852561e-06), (("agentPaddle", 3, 140), -0.009857749501875306), (("ball", 0, 160, 190), -0.023290297243365638), (("ball", 0, 60, 150), -3.0001274555372286e-08), (("ball", 2, 160, 50), -0.0003381006587402825), (("ballBelow", 2), -0.04649699176160786), (("ball", 2, 90, 110), 0.0025993366680168843), (("ball", 0, 160, 180), -0.0068782188886447795), (("ball", 3, 100, 190), -5.583715034587303e-07), (("ball", 2, 130, 170), 0.0017128713408613154), (("ball", 3, 0, 100), 0.0039546494606419475), (("ball", 0, 60, 140), 0.00020807250735283375), (("ball", 3, 0, 90), 0.0009713899253121273), (("ball", 3, 50, 70), 0.0027496900350176324), (("ball", 2, 130, 160), 0.002182293735630689), (("ball", 0, 100, 90), 0.0012530227849154214), (("ball", 3, 90, 120), 0.0013311648720142736), (("ball", 0, 140, 190), -7.268179794231005e-05), (("agentPaddle", 2, 180), -0.006139889930332785), (("ball", 2, 130, 190), -0.0009197828161886337), (("ball", 0, 100, 160), 0.00040231599499097875), (("ball", 0, 90, 130), 0.0003160057045235174), (("ball", 2, 70, 170), 0.00032903945201131726), (("ball", 2, 130, 180), 0.0003869087449355102), (("ball", 2, 90, 70), 0.0004634076350699417), (("ball", 2, 60, 140), 0.00038197597601044765), (("ball", 0, 70, 140), 0.00021575195227868066), (("ball", 2, 20, 170), -0.008815334862493347), (("ball", 2, 20, 110), -0.00023083918297904778), (("ball", 3, 0, 70), 0.0), (("ball", 0, 150, 120), -0.0011703678043098124), (("ball", 2, 90, 80), 0.0005599292237944626), (("ball", 3, 50, 100), 0.001092737413849739), (("ball", 0, 10, 100), 0.0010129619282506959), (("vx-", 3), 0.010274909404358058), (("ball", 0, 90, 170), 0.00018216117120615144))
        self.weights = defaultdict(float)
        for k, v in w:
            self.weights[k] = v

    # Return the Q function associated with the weights and features
    def getQ(self, state, action):
        score = state[2]
        features = self.featureExtractor(state, action)
        for f, v in features:
            score += self.weights[f] * v
        return score

    """Chooses an action following an epsilon greedy algorithm. Makes random choice with probability explorationProb/4,
    a baseline action with probabilty 3/4*explorationProb, and a choice based on Qopt with probability 1 - explorationProb
    """
    def getAction(self, state, done):
        if done:
            return 0
        #random choice
        if random.random() < self.explorationProb/4:
            return random.choice([0, 2, 3])
        #baseline choice
        if random.random() < self.explorationProb:
            for i in range(35, 195):
                row = state[1][i]
                #ball is in row
                if [236, 236, 236] in row:
                    return 2 #go up
                #paddle is in row
                if [92, 186, 92] in row:
                    return 3 #go down
            #do nothing
            return 0
        #Qopt choice
        else:
            return max((self.getQ(state, action), action) for action in self.actions)[1]

    # Returns step size
    def getStepSize(self):
        return .001

    """
    state: (previous Observation, current Observation, score)
    action: action taken
    reward: +1 if scored, -1 if opponent scored, 0 otherwise
    newState: (current Observation, new Observation, score)

    Updates dictionary of weights according to state, new state, reward, and action taken.
    """
    def incorporateFeedback(self, state, action, reward, newState):
        # BEGIN_YOUR_CODE (our solution is 12 lines of code, but don't worry if you deviate from this)
        if newState != None:
            Vopt = max(self.getQ(newState, a) for a in self.actions)
            for feature, value in self.featureExtractor(state, action):
                self.weights[feature] -= self.getStepSize()*(self.getQ(state, action) - (reward + self.discount*Vopt))*value
        # END_YOUR_CODE

    #Returns the dictionary current weights
    def getWeights(self):
        return self.weights
    
    """
    p = exploration Probability
    Sets the current exploration Probability to p 
    """
    def setExplorationProbability(self, p):
        self.explorationProb = p

    #returns current exploration probability
    def getExProb(self):
        return self.explorationProb

"""
obs = RGB array of frame
Determines ball and paddle locations based on their pixel colors. Each position is the uppermost 
pixel of eitehr the paddle or the ball 
Returns a numpy array of [row of ball, column of ball, row of paddle]
"""
@jit(nopython=True, cache=True)
def getPositions(obs):
    answer = np.zeros(3)
    for i in range(192, 37, -1):
        for j in range(0, 160):
            #ball
            if obs[i, j, 0] == 236 and obs[i, j, 1] == 236 and obs[i, j, 2] == 236:
                answer[0] = i
                answer[1] = j
            #paddle
            elif obs[i, j, 0] == 92 and obs[i, j, 1] == 186 and obs[i, j, 2] ==  92:
                answer[2] = i
    return answer

"""
x: integer
Returns x rounded to the nearest 10
"""
def round(x):
    divided = (int(x)/10)*10
    if math.fabs(x - divided) > math.fabs(x -(divided + 10)):
        return divided + 10
    return divided

#
"""
state: tuple of previous Observation(RGB array), current Observation (RGB array), and score
action: 0, 2, or 3

Extracts features from a given state. 
Returns a feature list of (feature, value)
"""
def featureExtractorState(state, action):
    features = []
    curPos = getPositions(state[1])
    prevPos = getPositions(state[0])
    
    xvelocity = curPos[1] - prevPos[1]
    yvelocity = curPos[0] - prevPos[0]

    #whether x and y velocity are positive or negative 
    if xvelocity > 0:
        features.append((("vx+", action), 1))
    else:
        features.append((("vx-", action), 1))
    
    if yvelocity > 0:
        features.append((("vy+", action), 1))
    else:
        features.append((("vy-", action), 1))
    
    #rounded version of current Agent's paddle y position
    if round(curPos[2]) != 0:
        features.append((("agentPaddle", action, round(curPos[2])), 1))
    #rounded version of current ball's x and y position
    if round(curPos[0]) != 0:
        features.append((("ball", action, round(curPos[1]), round(curPos[0])), 1))
    
    #Whether ball is above, below, or at same height of Agent's paddle
    if curPos[0] - curPos[2] > 36:
        features.append((("ballBelow", action), 1))
    elif curPos[0] - curPos[2] > 0:
        features.append((("ballSame", action), 1))
    else:
        features.append((("ballAbove", action), 1))
    return features

"""
Plays num_games games of Pong with actions directed by QLearningAlgorithm's getAction function, which is a function approximation by linear regression of a dictionary of features
of the current state and actions. 
"""
class QLearningAgent(object):
    def __init__(self, action_space):
        self.action_space = action_space

    def act(self, observation, reward, done, q):
        return q.getAction(observation, done)

if __name__ == '__main__':
    logger.set_level(logger.WARN)

    #Opens a Pong environment
    env = gym.make('Pong-v0')

    #directory to output game statistics
    outdir = 'tmp/results'
    env = wrappers.Monitor(env, directory=outdir, force=True)
    env.seed(0)
    agent = QLearningAgent(env.action_space)

    num_games = 200
    reward = 0
    done = False
      
    q = QLearningAlgorithm([0, 2, 3], discount = 1, featureExtractor = featureExtractorState, explorationProb=0)

    #plays num_games number of games 
    for i in range(num_games):
        new_observation = env.reset()
        observation = new_observation
        prev_obs = observation
        
        #number of points scored by agent
        score = 0
        while True:
            env.render() #allows video of game in progress to be shown 
            action = agent.act((observation, new_observation, score), reward, done, q)
            prev_obs = observation
            observation = new_observation
            new_observation, reward, done, _ = env.step(action) #go to next action
            if reward == 1.0:
                score += 1
            
            #used during training
            #q.incorporateFeedback((prev_obs, observation, score), action, reward, (observation, new_observation, score)) 
            
            #the end of the game has been reached
            if done:
                break
        if i % 50 == 0:
            print q.getWeights()
        if i % 50 == 0 and i != 0:
            curProb = q.getExProb()
            q.setExplorationProbability(max([curProb - .8, 0]))
        print(str(i) + " games completed with current game's score " + str(score))
    #Closes the environment            
    env.close()
